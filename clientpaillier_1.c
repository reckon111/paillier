#include <sys/types.h>
#include <sys/socket.h>
#include <stdio.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <gmp.h>
#include <time.h>
#include <sys/time.h>
#include "dictionary.h"
#include<mysql/mysql.h>

#define MYPORT  4000
#define BUFFER_SIZE 1024
#define KEYSIZE 2048
#define BASE 16
#define NAMESIZE 128
#define DATASIZE 2000
#define HEADER_SIZE 5
#define MSG1BYTES_LEN 4 
#define MSG2BYTES_LEN 4
#define TYPE_LEN 1

struct rawdata{
    char name[NAMESIZE];
    unsigned long number;
};

struct encidata{
    char name[NAMESIZE];
    mpz_t encinumber;
};

int bits_10baseofnumber(int n);
void my_fgets(char *str, int size);
void secure_send(int fd, char* send_data);
void secure_recv(int sock_cli, char **precvd_msg);
char* encode_msg(int type, char* msg1, char* msg2);
void rd2ed(struct rawdata *rdata, struct encidata *edata, int size, mpz_t pk_n, mpz_t pk_g);
void edata_init(struct encidata* edata, int size);
void edata_clear(struct encidata* edata, int size);
char* make_msg(char* fmt,mpz_t msg1);
void get_nbits_randprime(mpz_t randprime, int n);
void get_randr(mpz_t r, mpz_t n);
void key_generate(mpz_t pk_n, mpz_t pk_g, mpz_t sk_lambda, mpz_t sk_mu);
void encipher(mpz_t encipher_msg, mpz_t n, mpz_t g, unsigned long m);
unsigned long decipher( mpz_t encipher_msg, mpz_t n ,mpz_t lambda, mpz_t mu);


int main()
{   mpz_t pk_n, pk_g, sk_lambda, sk_mu, encipher_msg, rel_mpz;
    // unsigned long msg1 = 51654544, msg2 = 2660, msg3;
    
    //  设定原始数据；
    struct rawdata rdata[DATASIZE]={
        {"m1", 486080},
        {"m2", 811612},
        {"m3", 956457},
        {"m4", 374017},
        {"m5", 272888},
        {"m6", 750005},
        {"m7", 456370},
        {"m8", 210193},
        {"m9", 52169},
        {"m10", 25259},
        {"m11", 621492},
        {"m12", 571112},
        {"m13", 744611},
        {"m14", 494785},
        {"m15", 992018},
        {"m16", 690373},
        {"m17", 892656},
        {"m18", 615563},
        {"m19", 371026},
        {"m20", 143851},
        {"m21", 512771},
        {"m22", 811955},
        {"m23", 476701},
        {"m24", 90337},
        {"m25", 850802},
        {"m26", 52328},
        {"m27", 464126},
        {"m28", 227759},
        {"m29", 75265},
        {"m30", 75460},
        {"m31", 129471},
        {"m32", 523180},
        {"m33", 850170},
        {"m34", 704809},
        {"m35", 963506},
        {"m36", 27885},
        {"m37", 816983},
        {"m38", 246147},
        {"m39", 36114},
        {"m40", 704560},
        {"m41", 303794},
        {"m42", 914200},
        {"m43", 220821},
        {"m44", 917391},
        {"m45", 984767},
        {"m46", 543854},
        {"m47", 60364},
        {"m48", 173098},
        {"m49", 356684},
        {"m50", 882803},
        {"m51", 471454},
        {"m52", 138451},
        {"m53", 752965},
        {"m54", 169823},
        {"m55", 455774},
        {"m56", 21400},
        {"m57", 145202},
        {"m58", 99968},
        {"m59", 140872},
        {"m60", 57913},
        {"m61", 873580},
        {"m62", 666325},
        {"m63", 211169},
        {"m64", 887194},
        {"m65", 141363},
        {"m66", 709421},
        {"m67", 11755},
        {"m68", 419326},
        {"m69", 841626},
        {"m70", 260126},
        {"m71", 415206},
        {"m72", 637976},
        {"m73", 995558},
        {"m74", 23064},
        {"m75", 1191},
        {"m76", 848682},
        {"m77", 33216},
        {"m78", 886400},
        {"m79", 945407},
        {"m80", 47385},
        {"m81", 907221},
        {"m82", 487837},
        {"m83", 682722},
        {"m84", 13092},
        {"m85", 129438},
        {"m86", 651470},
        {"m87", 173170},
        {"m88", 463544},
        {"m89", 622349},
        {"m90", 738225},
        {"m91", 110384},
        {"m92", 532834},
        {"m93", 339891},
        {"m94", 609912},
        {"m95", 767704},
        {"m96", 590129},
        {"m97", 569474},
        {"m98", 377899},
        {"m99", 377494},
        {"m100", 776476},
        {"m101", 226754},
        {"m102", 137453},
        {"m103", 697761},
        {"m104", 803178},
        {"m105", 63919},
        {"m106", 472582},
        {"m107", 987713},
        {"m108", 641233},
        {"m109", 240494},
        {"m110", 828665},
        {"m111", 260567},
        {"m112", 822394},
        {"m113", 252270},
        {"m114", 248681},
        {"m115", 529892},
        {"m116", 760616},
        {"m117", 781903},
        {"m118", 770697},
        {"m119", 792703},
        {"m120", 980504},
        {"m121", 51075},
        {"m122", 851085},
        {"m123", 899495},
        {"m124", 74100},
        {"m125", 895610},
        {"m126", 331456},
        {"m127", 661352},
        {"m128", 198318},
        {"m129", 134758},
        {"m130", 365036},
        {"m131", 739046},
        {"m132", 764191},
        {"m133", 272497},
        {"m134", 366374},
        {"m135", 98533},
        {"m136", 968402},
        {"m137", 320120},
        {"m138", 914993},
        {"m139", 662884},
        {"m140", 336866},
        {"m141", 212725},
        {"m142", 185906},
        {"m143", 563615},
        {"m144", 69665},
        {"m145", 231372},
        {"m146", 817975},
        {"m147", 467693},
        {"m148", 257738},
        {"m149", 751401},
        {"m150", 501648},
        {"m151", 514856},
        {"m152", 188699},
        {"m153", 884922},
        {"m154", 633635},
        {"m155", 52359},
        {"m156", 100082},
        {"m157", 958685},
        {"m158", 139430},
        {"m159", 766522},
        {"m160", 408441},
        {"m161", 499156},
        {"m162", 653574},
        {"m163", 242568},
        {"m164", 273018},
        {"m165", 675522},
        {"m166", 855411},
        {"m167", 749862},
        {"m168", 404094},
        {"m169", 581765},
        {"m170", 424953},
        {"m171", 396300},
        {"m172", 851531},
        {"m173", 616988},
        {"m174", 990516},
        {"m175", 816354},
        {"m176", 614574},
        {"m177", 682119},
        {"m178", 39335},
        {"m179", 637585},
        {"m180", 591541},
        {"m181", 578795},
        {"m182", 789316},
        {"m183", 127411},
        {"m184", 829014},
        {"m185", 503921},
        {"m186", 998112},
        {"m187", 814308},
        {"m188", 353267},
        {"m189", 66082},
        {"m190", 298410},
        {"m191", 756542},
        {"m192", 835463},
        {"m193", 228761},
        {"m194", 955953},
        {"m195", 632082},
        {"m196", 656988},
        {"m197", 635668},
        {"m198", 814568},
        {"m199", 761808},
        {"m200", 88166},
        {"m201", 705866},
        {"m202", 244376},
        {"m203", 437834},
        {"m204", 42978},
        {"m205", 561563},
        {"m206", 134679},
        {"m207", 124658},
        {"m208", 663729},
        {"m209", 65860},
        {"m210", 286347},
        {"m211", 212720},
        {"m212", 947864},
        {"m213", 146213},
        {"m214", 989667},
        {"m215", 461245},
        {"m216", 300672},
        {"m217", 585878},
        {"m218", 328932},
        {"m219", 956997},
        {"m220", 825946},
        {"m221", 447283},
        {"m222", 227776},
        {"m223", 981695},
        {"m224", 864131},
        {"m225", 621275},
        {"m226", 87284},
        {"m227", 524679},
        {"m228", 53706},
        {"m229", 751235},
        {"m230", 570001},
        {"m231", 441461},
        {"m232", 176581},
        {"m233", 879965},
        {"m234", 546924},
        {"m235", 287543},
        {"m236", 293538},
        {"m237", 939849},
        {"m238", 98121},
        {"m239", 204196},
        {"m240", 16838},
        {"m241", 985257},
        {"m242", 66947},
        {"m243", 888077},
        {"m244", 126743},
        {"m245", 125121},
        {"m246", 846259},
        {"m247", 82002},
        {"m248", 172253},
        {"m249", 314646},
        {"m250", 732212},
        {"m251", 981558},
        {"m252", 313383},
        {"m253", 917831},
        {"m254", 436067},
        {"m255", 519215},
        {"m256", 670092},
        {"m257", 664058},
        {"m258", 215311},
        {"m259", 396522},
        {"m260", 814191},
        {"m261", 683892},
        {"m262", 87567},
        {"m263", 702078},
        {"m264", 649968},
        {"m265", 894043},
        {"m266", 422910},
        {"m267", 533387},
        {"m268", 731784},
        {"m269", 835427},
        {"m270", 711786},
        {"m271", 914708},
        {"m272", 928987},
        {"m273", 750583},
        {"m274", 569520},
        {"m275", 304322},
        {"m276", 440609},
        {"m277", 312618},
        {"m278", 933345},
        {"m279", 450081},
        {"m280", 320439},
        {"m281", 216584},
        {"m282", 817996},
        {"m283", 766386},
        {"m284", 395022},
        {"m285", 455272},
        {"m286", 898298},
        {"m287", 221563},
        {"m288", 771197},
        {"m289", 826468},
        {"m290", 502585},
        {"m291", 533276},
        {"m292", 110670},
        {"m293", 285260},
        {"m294", 889810},
        {"m295", 294786},
        {"m296", 451469},
        {"m297", 414024},
        {"m298", 759814},
        {"m299", 697480},
        {"m300", 430664},
        {"m301", 695878},
        {"m302", 763971},
        {"m303", 646577},
        {"m304", 862772},
        {"m305", 989339},
        {"m306", 595725},
        {"m307", 963799},
        {"m308", 714582},
        {"m309", 158040},
        {"m310", 767459},
        {"m311", 991764},
        {"m312", 602225},
        {"m313", 867712},
        {"m314", 625008},
        {"m315", 477724},
        {"m316", 246341},
        {"m317", 826026},
        {"m318", 910707},
        {"m319", 542748},
        {"m320", 720139},
        {"m321", 201475},
        {"m322", 570758},
        {"m323", 484750},
        {"m324", 678914},
        {"m325", 156072},
        {"m326", 866332},
        {"m327", 399911},
        {"m328", 651613},
        {"m329", 100465},
        {"m330", 438399},
        {"m331", 782372},
        {"m332", 952392},
        {"m333", 83795},
        {"m334", 854278},
        {"m335", 863407},
        {"m336", 943898},
        {"m337", 475585},
        {"m338", 269967},
        {"m339", 83645},
        {"m340", 343959},
        {"m341", 156022},
        {"m342", 459099},
        {"m343", 354972},
        {"m344", 574199},
        {"m345", 610437},
        {"m346", 248706},
        {"m347", 607666},
        {"m348", 721063},
        {"m349", 127853},
        {"m350", 109587},
        {"m351", 372032},
        {"m352", 846378},
        {"m353", 497693},
        {"m354", 774489},
        {"m355", 646125},
        {"m356", 897971},
        {"m357", 737907},
        {"m358", 342695},
        {"m359", 290081},
        {"m360", 176313},
        {"m361", 99654},
        {"m362", 508591},
        {"m363", 979675},
        {"m364", 935562},
        {"m365", 241480},
        {"m366", 248833},
        {"m367", 94407},
        {"m368", 619111},
        {"m369", 390717},
        {"m370", 604233},
        {"m371", 844230},
        {"m372", 301822},
        {"m373", 745977},
        {"m374", 757809},
        {"m375", 538888},
        {"m376", 664252},
        {"m377", 465200},
        {"m378", 875613},
        {"m379", 231033},
        {"m380", 595353},
        {"m381", 965256},
        {"m382", 657192},
        {"m383", 954080},
        {"m384", 223722},
        {"m385", 141557},
        {"m386", 420845},
        {"m387", 641045},
        {"m388", 669308},
        {"m389", 189362},
        {"m390", 445890},
        {"m391", 367926},
        {"m392", 108590},
        {"m393", 915867},
        {"m394", 67738},
        {"m395", 708733},
        {"m396", 567848},
        {"m397", 697939},
        {"m398", 24934},
        {"m399", 980103},
        {"m400", 115125},
        {"m401", 272726},
        {"m402", 374707},
        {"m403", 111732},
        {"m404", 561119},
        {"m405", 266691},
        {"m406", 312389},
        {"m407", 879466},
        {"m408", 849206},
        {"m409", 723667},
        {"m410", 618132},
        {"m411", 862341},
        {"m412", 274151},
        {"m413", 783250},
        {"m414", 798388},
        {"m415", 509098},
        {"m416", 183499},
        {"m417", 306398},
        {"m418", 574303},
        {"m419", 584463},
        {"m420", 516317},
        {"m421", 714286},
        {"m422", 401278},
        {"m423", 326849},
        {"m424", 893604},
        {"m425", 656983},
        {"m426", 329242},
        {"m427", 572823},
        {"m428", 19346},
        {"m429", 422986},
        {"m430", 885000},
        {"m431", 928983},
        {"m432", 201317},
        {"m433", 518884},
        {"m434", 130419},
        {"m435", 973668},
        {"m436", 546830},
        {"m437", 445764},
        {"m438", 64298},
        {"m439", 569970},
        {"m440", 250894},
        {"m441", 945377},
        {"m442", 559069},
        {"m443", 542924},
        {"m444", 754022},
        {"m445", 160811},
        {"m446", 182967},
        {"m447", 148591},
        {"m448", 490848},
        {"m449", 945240},
        {"m450", 507365},
        {"m451", 356113},
        {"m452", 830259},
        {"m453", 902323},
        {"m454", 945972},
        {"m455", 586227},
        {"m456", 97928},
        {"m457", 773686},
        {"m458", 196908},
        {"m459", 739609},
        {"m460", 194076},
        {"m461", 608234},
        {"m462", 771643},
        {"m463", 245107},
        {"m464", 451533},
        {"m465", 141220},
        {"m466", 899135},
        {"m467", 261603},
        {"m468", 684485},
        {"m469", 21117},
        {"m470", 81706},
        {"m471", 560790},
        {"m472", 985011},
        {"m473", 556298},
        {"m474", 692511},
        {"m475", 590504},
        {"m476", 343975},
        {"m477", 699438},
        {"m478", 717113},
        {"m479", 937372},
        {"m480", 396543},
        {"m481", 66344},
        {"m482", 160787},
        {"m483", 320560},
        {"m484", 37122},
        {"m485", 219511},
        {"m486", 464306},
        {"m487", 420567},
        {"m488", 459686},
        {"m489", 774579},
        {"m490", 56943},
        {"m491", 119714},
        {"m492", 147108},
        {"m493", 48699},
        {"m494", 187702},
        {"m495", 941117},
        {"m496", 470912},
        {"m497", 430690},
        {"m498", 762175},
        {"m499", 451710},
        {"m500", 881493},
        {"m501", 97304},
        {"m502", 389541},
        {"m503", 637394},
        {"m504", 934244},
        {"m505", 335801},
        {"m506", 799480},
        {"m507", 803973},
        {"m508", 39491},
        {"m509", 530037},
        {"m510", 46033},
        {"m511", 124581},
        {"m512", 84326},
        {"m513", 717115},
        {"m514", 636580},
        {"m515", 807642},
        {"m516", 510851},
        {"m517", 425907},
        {"m518", 219949},
        {"m519", 747611},
        {"m520", 861831},
        {"m521", 946041},
        {"m522", 488278},
        {"m523", 390456},
        {"m524", 904077},
        {"m525", 85713},
        {"m526", 280394},
        {"m527", 179188},
        {"m528", 370504},
        {"m529", 288514},
        {"m530", 621561},
        {"m531", 705382},
        {"m532", 322233},
        {"m533", 540875},
        {"m534", 632839},
        {"m535", 962925},
        {"m536", 302829},
        {"m537", 175421},
        {"m538", 615109},
        {"m539", 703865},
        {"m540", 276421},
        {"m541", 80125},
        {"m542", 453853},
        {"m543", 345952},
        {"m544", 374478},
        {"m545", 894192},
        {"m546", 901138},
        {"m547", 99731},
        {"m548", 414398},
        {"m549", 575437},
        {"m550", 288728},
        {"m551", 615916},
        {"m552", 606148},
        {"m553", 258629},
        {"m554", 711988},
        {"m555", 668361},
        {"m556", 694813},
        {"m557", 954985},
        {"m558", 75688},
        {"m559", 624037},
        {"m560", 683077},
        {"m561", 632500},
        {"m562", 644224},
        {"m563", 647699},
        {"m564", 972830},
        {"m565", 164311},
        {"m566", 178333},
        {"m567", 747041},
        {"m568", 339058},
        {"m569", 194504},
        {"m570", 382794},
        {"m571", 703169},
        {"m572", 962544},
        {"m573", 673702},
        {"m574", 112191},
        {"m575", 49985},
        {"m576", 764665},
        {"m577", 267493},
        {"m578", 649854},
        {"m579", 752992},
        {"m580", 369691},
        {"m581", 428852},
        {"m582", 312241},
        {"m583", 543434},
        {"m584", 574850},
        {"m585", 207120},
        {"m586", 336291},
        {"m587", 842611},
        {"m588", 306639},
        {"m589", 962258},
        {"m590", 695679},
        {"m591", 800150},
        {"m592", 427047},
        {"m593", 759076},
        {"m594", 480543},
        {"m595", 117377},
        {"m596", 667765},
        {"m597", 796030},
        {"m598", 675837},
        {"m599", 636747},
        {"m600", 827821},
        {"m601", 915582},
        {"m602", 963659},
        {"m603", 735153},
        {"m604", 838219},
        {"m605", 535700},
        {"m606", 324194},
        {"m607", 684796},
        {"m608", 120463},
        {"m609", 957779},
        {"m610", 914916},
        {"m611", 587535},
        {"m612", 959590},
        {"m613", 462040},
        {"m614", 969142},
        {"m615", 153267},
        {"m616", 997734},
        {"m617", 438739},
        {"m618", 512095},
        {"m619", 547441},
        {"m620", 647225},
        {"m621", 227925},
        {"m622", 765940},
        {"m623", 918745},
        {"m624", 403496},
        {"m625", 972832},
        {"m626", 75902},
        {"m627", 161265},
        {"m628", 321118},
        {"m629", 276960},
        {"m630", 967286},
        {"m631", 407833},
        {"m632", 302298},
        {"m633", 730559},
        {"m634", 563046},
        {"m635", 649841},
        {"m636", 776508},
        {"m637", 209210},
        {"m638", 157430},
        {"m639", 621340},
        {"m640", 456426},
        {"m641", 638449},
        {"m642", 670870},
        {"m643", 664126},
        {"m644", 919499},
        {"m645", 153769},
        {"m646", 884272},
        {"m647", 112736},
        {"m648", 922593},
        {"m649", 219645},
        {"m650", 180724},
        {"m651", 649831},
        {"m652", 147336},
        {"m653", 185105},
        {"m654", 402582},
        {"m655", 875205},
        {"m656", 476022},
        {"m657", 912986},
        {"m658", 916227},
        {"m659", 627593},
        {"m660", 831263},
        {"m661", 549680},
        {"m662", 316534},
        {"m663", 523857},
        {"m664", 596279},
        {"m665", 873289},
        {"m666", 166531},
        {"m667", 315391},
        {"m668", 750736},
        {"m669", 398457},
        {"m670", 897276},
        {"m671", 522639},
        {"m672", 404206},
        {"m673", 890331},
        {"m674", 375513},
        {"m675", 6456},
        {"m676", 473730},
        {"m677", 369769},
        {"m678", 342079},
        {"m679", 873574},
        {"m680", 543522},
        {"m681", 233768},
        {"m682", 498453},
        {"m683", 995550},
        {"m684", 775325},
        {"m685", 800032},
        {"m686", 565999},
        {"m687", 16567},
        {"m688", 780474},
        {"m689", 668138},
        {"m690", 775393},
        {"m691", 44526},
        {"m692", 882881},
        {"m693", 555835},
        {"m694", 767038},
        {"m695", 242608},
        {"m696", 221176},
        {"m697", 21517},
        {"m698", 432826},
        {"m699", 894255},
        {"m700", 799493},
        {"m701", 59666},
        {"m702", 47987},
        {"m703", 35616},
        {"m704", 997033},
        {"m705", 377510},
        {"m706", 437814},
        {"m707", 919395},
        {"m708", 848105},
        {"m709", 771603},
        {"m710", 515184},
        {"m711", 296809},
        {"m712", 730657},
        {"m713", 729319},
        {"m714", 658204},
        {"m715", 154719},
        {"m716", 696209},
        {"m717", 377471},
        {"m718", 992494},
        {"m719", 212883},
        {"m720", 100520},
        {"m721", 548766},
        {"m722", 830001},
        {"m723", 231751},
        {"m724", 822962},
        {"m725", 218690},
        {"m726", 961825},
        {"m727", 806160},
        {"m728", 802868},
        {"m729", 228587},
        {"m730", 836079},
        {"m731", 757284},
        {"m732", 255903},
        {"m733", 217669},
        {"m734", 107844},
        {"m735", 692321},
        {"m736", 10654},
        {"m737", 149660},
        {"m738", 946580},
        {"m739", 662458},
        {"m740", 896489},
        {"m741", 343958},
        {"m742", 149323},
        {"m743", 626520},
        {"m744", 101305},
        {"m745", 137036},
        {"m746", 117841},
        {"m747", 711987},
        {"m748", 1267},
        {"m749", 962753},
        {"m750", 268817},
        {"m751", 616387},
        {"m752", 86790},
        {"m753", 592620},
        {"m754", 854876},
        {"m755", 517154},
        {"m756", 97776},
        {"m757", 131435},
        {"m758", 387450},
        {"m759", 406266},
        {"m760", 607087},
        {"m761", 603877},
        {"m762", 634332},
        {"m763", 312860},
        {"m764", 421572},
        {"m765", 217484},
        {"m766", 595924},
        {"m767", 627147},
        {"m768", 487872},
        {"m769", 420059},
        {"m770", 151496},
        {"m771", 802464},
        {"m772", 710636},
        {"m773", 767290},
        {"m774", 370589},
        {"m775", 735843},
        {"m776", 292095},
        {"m777", 136675},
        {"m778", 4058},
        {"m779", 846133},
        {"m780", 560705},
        {"m781", 343050},
        {"m782", 381327},
        {"m783", 476406},
        {"m784", 364768},
        {"m785", 795000},
        {"m786", 838118},
        {"m787", 768238},
        {"m788", 586661},
        {"m789", 224411},
        {"m790", 678243},
        {"m791", 138544},
        {"m792", 809940},
        {"m793", 457938},
        {"m794", 123122},
        {"m795", 683679},
        {"m796", 458895},
        {"m797", 784366},
        {"m798", 375872},
        {"m799", 222786},
        {"m800", 367618},
        {"m801", 269991},
        {"m802", 934030},
        {"m803", 959141},
        {"m804", 400519},
        {"m805", 728364},
        {"m806", 126465},
        {"m807", 28146},
        {"m808", 643462},
        {"m809", 756567},
        {"m810", 650169},
        {"m811", 535967},
        {"m812", 871768},
        {"m813", 934734},
        {"m814", 708102},
        {"m815", 648862},
        {"m816", 63893},
        {"m817", 905334},
        {"m818", 247338},
        {"m819", 872289},
        {"m820", 584137},
        {"m821", 273427},
        {"m822", 630354},
        {"m823", 276206},
        {"m824", 925132},
        {"m825", 81773},
        {"m826", 534288},
        {"m827", 133583},
        {"m828", 995016},
        {"m829", 29808},
        {"m830", 609558},
        {"m831", 919950},
        {"m832", 965507},
        {"m833", 341421},
        {"m834", 317541},
        {"m835", 712464},
        {"m836", 838725},
        {"m837", 179456},
        {"m838", 268182},
        {"m839", 659414},
        {"m840", 140555},
        {"m841", 102096},
        {"m842", 713693},
        {"m843", 626332},
        {"m844", 541423},
        {"m845", 678714},
        {"m846", 581409},
        {"m847", 692969},
        {"m848", 616742},
        {"m849", 363778},
        {"m850", 628098},
        {"m851", 691484},
        {"m852", 228167},
        {"m853", 194555},
        {"m854", 159717},
        {"m855", 324341},
        {"m856", 662290},
        {"m857", 422257},
        {"m858", 890745},
        {"m859", 392620},
        {"m860", 310708},
        {"m861", 313945},
        {"m862", 15459},
        {"m863", 523494},
        {"m864", 501276},
        {"m865", 380597},
        {"m866", 596546},
        {"m867", 633472},
        {"m868", 123528},
        {"m869", 124482},
        {"m870", 419136},
        {"m871", 504392},
        {"m872", 901343},
        {"m873", 853958},
        {"m874", 940888},
        {"m875", 25932},
        {"m876", 391489},
        {"m877", 267365},
        {"m878", 659107},
        {"m879", 144602},
        {"m880", 859629},
        {"m881", 76672},
        {"m882", 328976},
        {"m883", 163363},
        {"m884", 885739},
        {"m885", 12913},
        {"m886", 719727},
        {"m887", 877838},
        {"m888", 601380},
        {"m889", 853248},
        {"m890", 821624},
        {"m891", 820360},
        {"m892", 872100},
        {"m893", 539235},
        {"m894", 592281},
        {"m895", 957079},
        {"m896", 810289},
        {"m897", 816605},
        {"m898", 734894},
        {"m899", 703052},
        {"m900", 593267},
        {"m901", 761207},
        {"m902", 776799},
        {"m903", 86829},
        {"m904", 29632},
        {"m905", 935096},
        {"m906", 469584},
        {"m907", 365421},
        {"m908", 27406},
        {"m909", 332694},
        {"m910", 822098},
        {"m911", 322441},
        {"m912", 502008},
        {"m913", 638367},
        {"m914", 803219},
        {"m915", 1561},
        {"m916", 194172},
        {"m917", 906291},
        {"m918", 239790},
        {"m919", 536618},
        {"m920", 930661},
        {"m921", 853715},
        {"m922", 118671},
        {"m923", 222980},
        {"m924", 793724},
        {"m925", 338110},
        {"m926", 198756},
        {"m927", 608747},
        {"m928", 845954},
        {"m929", 985923},
        {"m930", 343002},
        {"m931", 850039},
        {"m932", 524320},
        {"m933", 484259},
        {"m934", 820861},
        {"m935", 303961},
        {"m936", 98287},
        {"m937", 778921},
        {"m938", 939269},
        {"m939", 377114},
        {"m940", 973645},
        {"m941", 63212},
        {"m942", 870842},
        {"m943", 656101},
        {"m944", 123767},
        {"m945", 581039},
        {"m946", 976648},
        {"m947", 574109},
        {"m948", 468605},
        {"m949", 809405},
        {"m950", 622666},
        {"m951", 116588},
        {"m952", 46643},
        {"m953", 854972},
        {"m954", 120066},
        {"m955", 45660},
        {"m956", 314502},
        {"m957", 3983},
        {"m958", 99365},
        {"m959", 299441},
        {"m960", 393001},
        {"m961", 618635},
        {"m962", 36805},
        {"m963", 839946},
        {"m964", 83119},
        {"m965", 409039},
        {"m966", 595712},
        {"m967", 141573},
        {"m968", 570857},
        {"m969", 172512},
        {"m970", 855517},
        {"m971", 566220},
        {"m972", 446789},
        {"m973", 237804},
        {"m974", 497769},
        {"m975", 162583},
        {"m976", 706798},
        {"m977", 337455},
        {"m978", 273633},
        {"m979", 666318},
        {"m980", 622213},
        {"m981", 654459},
        {"m982", 873880},
        {"m983", 450821},
        {"m984", 563105},
        {"m985", 520248},
        {"m986", 392284},
        {"m987", 134488},
        {"m988", 326178},
        {"m989", 43226},
        {"m990", 890985},
        {"m991", 410757},
        {"m992", 294327},
        {"m993", 767013},
        {"m994", 601147},
        {"m995", 449372},
        {"m996", 55054},
        {"m997", 831410},
        {"m998", 498735},
        {"m999", 119484},
        {"m1000", 326853},
        {"m1001", 626331},
        {"m1002", 499724},
        {"m1003", 258196},
        {"m1004", 638178},
        {"m1005", 131352},
        {"m1006", 146809},
        {"m1007", 229724},
        {"m1008", 194336},
        {"m1009", 488051},
        {"m1010", 407294},
        {"m1011", 907030},
        {"m1012", 252248},
        {"m1013", 172860},
        {"m1014", 779829},
        {"m1015", 393673},
        {"m1016", 521590},
        {"m1017", 800241},
        {"m1018", 409091},
        {"m1019", 878717},
        {"m1020", 450392},
        {"m1021", 884283},
        {"m1022", 673923},
        {"m1023", 658976},
        {"m1024", 441446},
        {"m1025", 664801},
        {"m1026", 51643},
        {"m1027", 235051},
        {"m1028", 696162},
        {"m1029", 730342},
        {"m1030", 383442},
        {"m1031", 26082},
        {"m1032", 103692},
        {"m1033", 641095},
        {"m1034", 126107},
        {"m1035", 571242},
        {"m1036", 498080},
        {"m1037", 234039},
        {"m1038", 501182},
        {"m1039", 611599},
        {"m1040", 265197},
        {"m1041", 848498},
        {"m1042", 414625},
        {"m1043", 143879},
        {"m1044", 200309},
        {"m1045", 131221},
        {"m1046", 903013},
        {"m1047", 752441},
        {"m1048", 286242},
        {"m1049", 933991},
        {"m1050", 806630},
        {"m1051", 423548},
        {"m1052", 263225},
        {"m1053", 430039},
        {"m1054", 496930},
        {"m1055", 193230},
        {"m1056", 697088},
        {"m1057", 280111},
        {"m1058", 371475},
        {"m1059", 177957},
        {"m1060", 764903},
        {"m1061", 410765},
        {"m1062", 419452},
        {"m1063", 961766},
        {"m1064", 193521},
        {"m1065", 719834},
        {"m1066", 254094},
        {"m1067", 98972},
        {"m1068", 455407},
        {"m1069", 938059},
        {"m1070", 608216},
        {"m1071", 569877},
        {"m1072", 436200},
        {"m1073", 645387},
        {"m1074", 375020},
        {"m1075", 528074},
        {"m1076", 446849},
        {"m1077", 120477},
        {"m1078", 78555},
        {"m1079", 935162},
        {"m1080", 575916},
        {"m1081", 434544},
        {"m1082", 414162},
        {"m1083", 550607},
        {"m1084", 485173},
        {"m1085", 217833},
        {"m1086", 171617},
        {"m1087", 156218},
        {"m1088", 28775},
        {"m1089", 983082},
        {"m1090", 75624},
        {"m1091", 130250},
        {"m1092", 798065},
        {"m1093", 717330},
        {"m1094", 446020},
        {"m1095", 398242},
        {"m1096", 301989},
        {"m1097", 371514},
        {"m1098", 453053},
        {"m1099", 697308},
        {"m1100", 522048},
        {"m1101", 604162},
        {"m1102", 285439},
        {"m1103", 258895},
        {"m1104", 624933},
        {"m1105", 197378},
        {"m1106", 919523},
        {"m1107", 571880},
        {"m1108", 672979},
        {"m1109", 392704},
        {"m1110", 157652},
        {"m1111", 744414},
        {"m1112", 749848},
        {"m1113", 64417},
        {"m1114", 922722},
        {"m1115", 599147},
        {"m1116", 700227},
        {"m1117", 110798},
        {"m1118", 544038},
        {"m1119", 521123},
        {"m1120", 167770},
        {"m1121", 354918},
        {"m1122", 238222},
        {"m1123", 707777},
        {"m1124", 795475},
        {"m1125", 244201},
        {"m1126", 212153},
        {"m1127", 13095},
        {"m1128", 627907},
        {"m1129", 846302},
        {"m1130", 355429},
        {"m1131", 771504},
        {"m1132", 371492},
        {"m1133", 752245},
        {"m1134", 171622},
        {"m1135", 763813},
        {"m1136", 894435},
        {"m1137", 225918},
        {"m1138", 654863},
        {"m1139", 289930},
        {"m1140", 766399},
        {"m1141", 224296},
        {"m1142", 73808},
        {"m1143", 725259},
        {"m1144", 307103},
        {"m1145", 829068},
        {"m1146", 269962},
        {"m1147", 533297},
        {"m1148", 674232},
        {"m1149", 848967},
        {"m1150", 529916},
        {"m1151", 864345},
        {"m1152", 638995},
        {"m1153", 679520},
        {"m1154", 377359},
        {"m1155", 854763},
        {"m1156", 808357},
        {"m1157", 593474},
        {"m1158", 103067},
        {"m1159", 224960},
        {"m1160", 797530},
        {"m1161", 607204},
        {"m1162", 947486},
        {"m1163", 923700},
        {"m1164", 232825},
        {"m1165", 618274},
        {"m1166", 216022},
        {"m1167", 617947},
        {"m1168", 563818},
        {"m1169", 300417},
        {"m1170", 456842},
        {"m1171", 627882},
        {"m1172", 710176},
        {"m1173", 973879},
        {"m1174", 859084},
        {"m1175", 646318},
        {"m1176", 559658},
        {"m1177", 988194},
        {"m1178", 894584},
        {"m1179", 51723},
        {"m1180", 241633},
        {"m1181", 53532},
        {"m1182", 725094},
        {"m1183", 894457},
        {"m1184", 962738},
        {"m1185", 300168},
        {"m1186", 31475},
        {"m1187", 494374},
        {"m1188", 737985},
        {"m1189", 984644},
        {"m1190", 946264},
        {"m1191", 956922},
        {"m1192", 539138},
        {"m1193", 212702},
        {"m1194", 66502},
        {"m1195", 115691},
        {"m1196", 423121},
        {"m1197", 498192},
        {"m1198", 148480},
        {"m1199", 253811},
        {"m1200", 440127},
        {"m1201", 813796},
        {"m1202", 474477},
        {"m1203", 285569},
        {"m1204", 804431},
        {"m1205", 488355},
        {"m1206", 430346},
        {"m1207", 975921},
        {"m1208", 513745},
        {"m1209", 184439},
        {"m1210", 920419},
        {"m1211", 954146},
        {"m1212", 236381},
        {"m1213", 591527},
        {"m1214", 984908},
        {"m1215", 903407},
        {"m1216", 2788},
        {"m1217", 341030},
        {"m1218", 368773},
        {"m1219", 583088},
        {"m1220", 238611},
        {"m1221", 37074},
        {"m1222", 830781},
        {"m1223", 243877},
        {"m1224", 15883},
        {"m1225", 369406},
        {"m1226", 633076},
        {"m1227", 972550},
        {"m1228", 982149},
        {"m1229", 865534},
        {"m1230", 818080},
        {"m1231", 816895},
        {"m1232", 939062},
        {"m1233", 835901},
        {"m1234", 367993},
        {"m1235", 190355},
        {"m1236", 35784},
        {"m1237", 669838},
        {"m1238", 610470},
        {"m1239", 999495},
        {"m1240", 629621},
        {"m1241", 839277},
        {"m1242", 79626},
        {"m1243", 257267},
        {"m1244", 394386},
        {"m1245", 582348},
        {"m1246", 63727},
        {"m1247", 733812},
        {"m1248", 902942},
        {"m1249", 318869},
        {"m1250", 892482},
        {"m1251", 914921},
        {"m1252", 392600},
        {"m1253", 523665},
        {"m1254", 658603},
        {"m1255", 136670},
        {"m1256", 748147},
        {"m1257", 461220},
        {"m1258", 494471},
        {"m1259", 447391},
        {"m1260", 469210},
        {"m1261", 77383},
        {"m1262", 659942},
        {"m1263", 640943},
        {"m1264", 654649},
        {"m1265", 487717},
        {"m1266", 26695},
        {"m1267", 956606},
        {"m1268", 600492},
        {"m1269", 350689},
        {"m1270", 386642},
        {"m1271", 122695},
        {"m1272", 992655},
        {"m1273", 802051},
        {"m1274", 760217},
        {"m1275", 642671},
        {"m1276", 422688},
        {"m1277", 829723},
        {"m1278", 655058},
        {"m1279", 965340},
        {"m1280", 183044},
        {"m1281", 387622},
        {"m1282", 286992},
        {"m1283", 227915},
        {"m1284", 185589},
        {"m1285", 383121},
        {"m1286", 818224},
        {"m1287", 187830},
        {"m1288", 356132},
        {"m1289", 367004},
        {"m1290", 189746},
        {"m1291", 716323},
        {"m1292", 229203},
        {"m1293", 133556},
        {"m1294", 889309},
        {"m1295", 215854},
        {"m1296", 880014},
        {"m1297", 919868},
        {"m1298", 94741},
        {"m1299", 966960},
        {"m1300", 935297},
        {"m1301", 896357},
        {"m1302", 971571},
        {"m1303", 155172},
        {"m1304", 52071},
        {"m1305", 999188},
        {"m1306", 590915},
        {"m1307", 276434},
        {"m1308", 810140},
        {"m1309", 99591},
        {"m1310", 353611},
        {"m1311", 960383},
        {"m1312", 805979},
        {"m1313", 300592},
        {"m1314", 380879},
        {"m1315", 561836},
        {"m1316", 439757},
        {"m1317", 648403},
        {"m1318", 125963},
        {"m1319", 8968},
        {"m1320", 993640},
        {"m1321", 757166},
        {"m1322", 492904},
        {"m1323", 131932},
        {"m1324", 631470},
        {"m1325", 783498},
        {"m1326", 119234},
        {"m1327", 384191},
        {"m1328", 129817},
        {"m1329", 648420},
        {"m1330", 329321},
        {"m1331", 519717},
        {"m1332", 452099},
        {"m1333", 668428},
        {"m1334", 33563},
        {"m1335", 690193},
        {"m1336", 730581},
        {"m1337", 877800},
        {"m1338", 719909},
        {"m1339", 608259},
        {"m1340", 310200},
        {"m1341", 267803},
        {"m1342", 870774},
        {"m1343", 683817},
        {"m1344", 830607},
        {"m1345", 43219},
        {"m1346", 864781},
        {"m1347", 807104},
        {"m1348", 70594},
        {"m1349", 948277},
        {"m1350", 829082},
        {"m1351", 515062},
        {"m1352", 474862},
        {"m1353", 483553},
        {"m1354", 502670},
        {"m1355", 134881},
        {"m1356", 560429},
        {"m1357", 734532},
        {"m1358", 514939},
        {"m1359", 767079},
        {"m1360", 678142},
        {"m1361", 717810},
        {"m1362", 940642},
        {"m1363", 387098},
        {"m1364", 96887},
        {"m1365", 348365},
        {"m1366", 416733},
        {"m1367", 720945},
        {"m1368", 407571},
        {"m1369", 711613},
        {"m1370", 941335},
        {"m1371", 308660},
        {"m1372", 509861},
        {"m1373", 314334},
        {"m1374", 787210},
        {"m1375", 791254},
        {"m1376", 498638},
        {"m1377", 523032},
        {"m1378", 167505},
        {"m1379", 342008},
        {"m1380", 717205},
        {"m1381", 472615},
        {"m1382", 717891},
        {"m1383", 193064},
        {"m1384", 1033},
        {"m1385", 897214},
        {"m1386", 456153},
        {"m1387", 339853},
        {"m1388", 143909},
        {"m1389", 423440},
        {"m1390", 192958},
        {"m1391", 488986},
        {"m1392", 604247},
        {"m1393", 926900},
        {"m1394", 38241},
        {"m1395", 597937},
        {"m1396", 407933},
        {"m1397", 935173},
        {"m1398", 498081},
        {"m1399", 420919},
        {"m1400", 483802},
        {"m1401", 18808},
        {"m1402", 501692},
        {"m1403", 180930},
        {"m1404", 540816},
        {"m1405", 754073},
        {"m1406", 117038},
        {"m1407", 718721},
        {"m1408", 246279},
        {"m1409", 773254},
        {"m1410", 675474},
        {"m1411", 454256},
        {"m1412", 145622},
        {"m1413", 539885},
        {"m1414", 131158},
        {"m1415", 743044},
        {"m1416", 103238},
        {"m1417", 66072},
        {"m1418", 835269},
        {"m1419", 907341},
        {"m1420", 871628},
        {"m1421", 940916},
        {"m1422", 668115},
        {"m1423", 160357},
        {"m1424", 596418},
        {"m1425", 852743},
        {"m1426", 987944},
        {"m1427", 80146},
        {"m1428", 200965},
        {"m1429", 213990},
        {"m1430", 555790},
        {"m1431", 150731},
        {"m1432", 584951},
        {"m1433", 684858},
        {"m1434", 54154},
        {"m1435", 299147},
        {"m1436", 841798},
        {"m1437", 827817},
        {"m1438", 610737},
        {"m1439", 548605},
        {"m1440", 413103},
        {"m1441", 158250},
        {"m1442", 148856},
        {"m1443", 40595},
        {"m1444", 332951},
        {"m1445", 803998},
        {"m1446", 271615},
        {"m1447", 328414},
        {"m1448", 776904},
        {"m1449", 945329},
        {"m1450", 564829},
        {"m1451", 979341},
        {"m1452", 905847},
        {"m1453", 701452},
        {"m1454", 338640},
        {"m1455", 56486},
        {"m1456", 452258},
        {"m1457", 931656},
        {"m1458", 893449},
        {"m1459", 744389},
        {"m1460", 620617},
        {"m1461", 339577},
        {"m1462", 220721},
        {"m1463", 86281},
        {"m1464", 681387},
        {"m1465", 604351},
        {"m1466", 604572},
        {"m1467", 890690},
        {"m1468", 129434},
        {"m1469", 18039},
        {"m1470", 159947},
        {"m1471", 507827},
        {"m1472", 984740},
        {"m1473", 549746},
        {"m1474", 938656},
        {"m1475", 992558},
        {"m1476", 16817},
        {"m1477", 65943},
        {"m1478", 162517},
        {"m1479", 912669},
        {"m1480", 33838},
        {"m1481", 826402},
        {"m1482", 149176},
        {"m1483", 224226},
        {"m1484", 719023},
        {"m1485", 129472},
        {"m1486", 894938},
        {"m1487", 340778},
        {"m1488", 808946},
        {"m1489", 212501},
        {"m1490", 453789},
        {"m1491", 838349},
        {"m1492", 683626},
        {"m1493", 278540},
        {"m1494", 222075},
        {"m1495", 793976},
        {"m1496", 28907},
        {"m1497", 307777},
        {"m1498", 922504},
        {"m1499", 210715},
        {"m1500", 907190},
        {"m1501", 161446},
        {"m1502", 434155},
        {"m1503", 294432},
        {"m1504", 61602},
        {"m1505", 366932},
        {"m1506", 138646},
        {"m1507", 625951},
        {"m1508", 938165},
        {"m1509", 328483},
        {"m1510", 438065},
        {"m1511", 601491},
        {"m1512", 405173},
        {"m1513", 607518},
        {"m1514", 843011},
        {"m1515", 6385},
        {"m1516", 504739},
        {"m1517", 956152},
        {"m1518", 860812},
        {"m1519", 144046},
        {"m1520", 911729},
        {"m1521", 814584},
        {"m1522", 282774},
        {"m1523", 401479},
        {"m1524", 467343},
        {"m1525", 195937},
        {"m1526", 900682},
        {"m1527", 25791},
        {"m1528", 452758},
        {"m1529", 911718},
        {"m1530", 200480},
        {"m1531", 884481},
        {"m1532", 514231},
        {"m1533", 34892},
        {"m1534", 855464},
        {"m1535", 514363},
        {"m1536", 464920},
        {"m1537", 736201},
        {"m1538", 313068},
        {"m1539", 866993},
        {"m1540", 980126},
        {"m1541", 548632},
        {"m1542", 163800},
        {"m1543", 418793},
        {"m1544", 728667},
        {"m1545", 864663},
        {"m1546", 610470},
        {"m1547", 745577},
        {"m1548", 461062},
        {"m1549", 198328},
        {"m1550", 42770},
        {"m1551", 169703},
        {"m1552", 774781},
        {"m1553", 65553},
        {"m1554", 659612},
        {"m1555", 36536},
        {"m1556", 598535},
        {"m1557", 562103},
        {"m1558", 880325},
        {"m1559", 84764},
        {"m1560", 421111},
        {"m1561", 950133},
        {"m1562", 267843},
        {"m1563", 270936},
        {"m1564", 597524},
        {"m1565", 176395},
        {"m1566", 416290},
        {"m1567", 400628},
        {"m1568", 863709},
        {"m1569", 513141},
        {"m1570", 84321},
        {"m1571", 269502},
        {"m1572", 629214},
        {"m1573", 304864},
        {"m1574", 578026},
        {"m1575", 445957},
        {"m1576", 628060},
        {"m1577", 997592},
        {"m1578", 188143},
        {"m1579", 133671},
        {"m1580", 734494},
        {"m1581", 853633},
        {"m1582", 515976},
        {"m1583", 761524},
        {"m1584", 348811},
        {"m1585", 18936},
        {"m1586", 956836},
        {"m1587", 727568},
        {"m1588", 502046},
        {"m1589", 898442},
        {"m1590", 48537},
        {"m1591", 806601},
        {"m1592", 43791},
        {"m1593", 372676},
        {"m1594", 207612},
        {"m1595", 310373},
        {"m1596", 476939},
        {"m1597", 229870},
        {"m1598", 833564},
        {"m1599", 373292},
        {"m1600", 212835},
        {"m1601", 502889},
        {"m1602", 607610},
        {"m1603", 875109},
        {"m1604", 222521},
        {"m1605", 813229},
        {"m1606", 371245},
        {"m1607", 748696},
        {"m1608", 78198},
        {"m1609", 588705},
        {"m1610", 35051},
        {"m1611", 504473},
        {"m1612", 38276},
        {"m1613", 176753},
        {"m1614", 593240},
        {"m1615", 997231},
        {"m1616", 761986},
        {"m1617", 21442},
        {"m1618", 496128},
        {"m1619", 454875},
        {"m1620", 126811},
        {"m1621", 383309},
        {"m1622", 693120},
        {"m1623", 525861},
        {"m1624", 639126},
        {"m1625", 63889},
        {"m1626", 411396},
        {"m1627", 193050},
        {"m1628", 276834},
        {"m1629", 633450},
        {"m1630", 215291},
        {"m1631", 235947},
        {"m1632", 468563},
        {"m1633", 106231},
        {"m1634", 829935},
        {"m1635", 367985},
        {"m1636", 464580},
        {"m1637", 157918},
        {"m1638", 872470},
        {"m1639", 822931},
        {"m1640", 215545},
        {"m1641", 560583},
        {"m1642", 795735},
        {"m1643", 2291},
        {"m1644", 74184},
        {"m1645", 166049},
        {"m1646", 997112},
        {"m1647", 879536},
        {"m1648", 614736},
        {"m1649", 514656},
        {"m1650", 310101},
        {"m1651", 527235},
        {"m1652", 192133},
        {"m1653", 345297},
        {"m1654", 518995},
        {"m1655", 922630},
        {"m1656", 209485},
        {"m1657", 151572},
        {"m1658", 199619},
        {"m1659", 955334},
        {"m1660", 636200},
        {"m1661", 3765},
        {"m1662", 882882},
        {"m1663", 793858},
        {"m1664", 407960},
        {"m1665", 309671},
        {"m1666", 681474},
        {"m1667", 379583},
        {"m1668", 576076},
        {"m1669", 710464},
        {"m1670", 992119},
        {"m1671", 289816},
        {"m1672", 423964},
        {"m1673", 935681},
        {"m1674", 821263},
        {"m1675", 441265},
        {"m1676", 453977},
        {"m1677", 748569},
        {"m1678", 375851},
        {"m1679", 616248},
        {"m1680", 264072},
        {"m1681", 520852},
        {"m1682", 421336},
        {"m1683", 387077},
        {"m1684", 726170},
        {"m1685", 530265},
        {"m1686", 951060},
        {"m1687", 323050},
        {"m1688", 38630},
        {"m1689", 10135},
        {"m1690", 802264},
        {"m1691", 393081},
        {"m1692", 237254},
        {"m1693", 59492},
        {"m1694", 456928},
        {"m1695", 51401},
        {"m1696", 680413},
        {"m1697", 895896},
        {"m1698", 797147},
        {"m1699", 895098},
        {"m1700", 634011},
        {"m1701", 110158},
        {"m1702", 511069},
        {"m1703", 992064},
        {"m1704", 806239},
        {"m1705", 396093},
        {"m1706", 845951},
        {"m1707", 620963},
        {"m1708", 217229},
        {"m1709", 491878},
        {"m1710", 925080},
        {"m1711", 608328},
        {"m1712", 840958},
        {"m1713", 756106},
        {"m1714", 107778},
        {"m1715", 876557},
        {"m1716", 704373},
        {"m1717", 967448},
        {"m1718", 712192},
        {"m1719", 521204},
        {"m1720", 328976},
        {"m1721", 937848},
        {"m1722", 324356},
        {"m1723", 220869},
        {"m1724", 763914},
        {"m1725", 998665},
        {"m1726", 318269},
        {"m1727", 611875},
        {"m1728", 973840},
        {"m1729", 35876},
        {"m1730", 647100},
        {"m1731", 365612},
        {"m1732", 577272},
        {"m1733", 745292},
        {"m1734", 831364},
        {"m1735", 472481},
        {"m1736", 777545},
        {"m1737", 716397},
        {"m1738", 745945},
        {"m1739", 416223},
        {"m1740", 995881},
        {"m1741", 398861},
        {"m1742", 189164},
        {"m1743", 823220},
        {"m1744", 503008},
        {"m1745", 454178},
        {"m1746", 145447},
        {"m1747", 852913},
        {"m1748", 483474},
        {"m1749", 855099},
        {"m1750", 223308},
        {"m1751", 118089},
        {"m1752", 569290},
        {"m1753", 317129},
        {"m1754", 975673},
        {"m1755", 986370},
        {"m1756", 852165},
        {"m1757", 30323},
        {"m1758", 905344},
        {"m1759", 216069},
        {"m1760", 306073},
        {"m1761", 166642},
        {"m1762", 426804},
        {"m1763", 269789},
        {"m1764", 735531},
        {"m1765", 299856},
        {"m1766", 634324},
        {"m1767", 604351},
        {"m1768", 408664},
        {"m1769", 801359},
        {"m1770", 32574},
        {"m1771", 361061},
        {"m1772", 798859},
        {"m1773", 123482},
        {"m1774", 847721},
        {"m1775", 779424},
        {"m1776", 199177},
        {"m1777", 50303},
        {"m1778", 639418},
        {"m1779", 434651},
        {"m1780", 694081},
        {"m1781", 504493},
        {"m1782", 883695},
        {"m1783", 489963},
        {"m1784", 447862},
        {"m1785", 871931},
        {"m1786", 437483},
        {"m1787", 783347},
        {"m1788", 312031},
        {"m1789", 636368},
        {"m1790", 983356},
        {"m1791", 391681},
        {"m1792", 817919},
        {"m1793", 177818},
        {"m1794", 247495},
        {"m1795", 483985},
        {"m1796", 891706},
        {"m1797", 373268},
        {"m1798", 416913},
        {"m1799", 582988},
        {"m1800", 529617},
        {"m1801", 99115},
        {"m1802", 202871},
        {"m1803", 413353},
        {"m1804", 964260},
        {"m1805", 522633},
        {"m1806", 578439},
        {"m1807", 423979},
        {"m1808", 913094},
        {"m1809", 300127},
        {"m1810", 996416},
        {"m1811", 637222},
        {"m1812", 815384},
        {"m1813", 883410},
        {"m1814", 420771},
        {"m1815", 312832},
        {"m1816", 750951},
        {"m1817", 148601},
        {"m1818", 913412},
        {"m1819", 328363},
        {"m1820", 173964},
        {"m1821", 579170},
        {"m1822", 254948},
        {"m1823", 779105},
        {"m1824", 534488},
        {"m1825", 349979},
        {"m1826", 326119},
        {"m1827", 863859},
        {"m1828", 922559},
        {"m1829", 232640},
        {"m1830", 627826},
        {"m1831", 948331},
        {"m1832", 744440},
        {"m1833", 348034},
        {"m1834", 409001},
        {"m1835", 213265},
        {"m1836", 240718},
        {"m1837", 118824},
        {"m1838", 185914},
        {"m1839", 337529},
        {"m1840", 556340},
        {"m1841", 522237},
        {"m1842", 716576},
        {"m1843", 263023},
        {"m1844", 420707},
        {"m1845", 623358},
        {"m1846", 885147},
        {"m1847", 474425},
        {"m1848", 601356},
        {"m1849", 839906},
        {"m1850", 662237},
        {"m1851", 864761},
        {"m1852", 764471},
        {"m1853", 372272},
        {"m1854", 70502},
        {"m1855", 780277},
        {"m1856", 709369},
        {"m1857", 389306},
        {"m1858", 787560},
        {"m1859", 841921},
        {"m1860", 198237},
        {"m1861", 236350},
        {"m1862", 541848},
        {"m1863", 889882},
        {"m1864", 62246},
        {"m1865", 97593},
        {"m1866", 885219},
        {"m1867", 963258},
        {"m1868", 186068},
        {"m1869", 844388},
        {"m1870", 318351},
        {"m1871", 286027},
        {"m1872", 444631},
        {"m1873", 852229},
        {"m1874", 753534},
        {"m1875", 178367},
        {"m1876", 994979},
        {"m1877", 140999},
        {"m1878", 100619},
        {"m1879", 22559},
        {"m1880", 898697},
        {"m1881", 619948},
        {"m1882", 450858},
        {"m1883", 888788},
        {"m1884", 594181},
        {"m1885", 92399},
        {"m1886", 463803},
        {"m1887", 626718},
        {"m1888", 596747},
        {"m1889", 552488},
        {"m1890", 732152},
        {"m1891", 504721},
        {"m1892", 959626},
        {"m1893", 819316},
        {"m1894", 298260},
        {"m1895", 512255},
        {"m1896", 592840},
        {"m1897", 597348},
        {"m1898", 540999},
        {"m1899", 699791},
        {"m1900", 576006},
        {"m1901", 272008},
        {"m1902", 196970},
        {"m1903", 485154},
        {"m1904", 959253},
        {"m1905", 512424},
        {"m1906", 391501},
        {"m1907", 902930},
        {"m1908", 627175},
        {"m1909", 860322},
        {"m1910", 91357},
        {"m1911", 123039},
        {"m1912", 825831},
        {"m1913", 95635},
        {"m1914", 496366},
        {"m1915", 746544},
        {"m1916", 514448},
        {"m1917", 539936},
        {"m1918", 813784},
        {"m1919", 544691},
        {"m1920", 57547},
        {"m1921", 567496},
        {"m1922", 290352},
        {"m1923", 731636},
        {"m1924", 256192},
        {"m1925", 724233},
        {"m1926", 442839},
        {"m1927", 383375},
        {"m1928", 614868},
        {"m1929", 220272},
        {"m1930", 507336},
        {"m1931", 233602},
        {"m1932", 485762},
        {"m1933", 253401},
        {"m1934", 169764},
        {"m1935", 383962},
        {"m1936", 328059},
        {"m1937", 735566},
        {"m1938", 909979},
        {"m1939", 587487},
        {"m1940", 277105},
        {"m1941", 443163},
        {"m1942", 715525},
        {"m1943", 357852},
        {"m1944", 257433},
        {"m1945", 250643},
        {"m1946", 352008},
        {"m1947", 652234},
        {"m1948", 656816},
        {"m1949", 698609},
        {"m1950", 313190},
        {"m1951", 966652},
        {"m1952", 688384},
        {"m1953", 926604},
        {"m1954", 123730},
        {"m1955", 977265},
        {"m1956", 474584},
        {"m1957", 996147},
        {"m1958", 685704},
        {"m1959", 468588},
        {"m1960", 517882},
        {"m1961", 576451},
        {"m1962", 527823},
        {"m1963", 233813},
        {"m1964", 532629},
        {"m1965", 264585},
        {"m1966", 511112},
        {"m1967", 138681},
        {"m1968", 844811},
        {"m1969", 90899},
        {"m1970", 967325},
        {"m1971", 470192},
        {"m1972", 820659},
        {"m1973", 552131},
        {"m1974", 578382},
        {"m1975", 43533},
        {"m1976", 659458},
        {"m1977", 182627},
        {"m1978", 75571},
        {"m1979", 157295},
        {"m1980", 524444},
        {"m1981", 61104},
        {"m1982", 36489},
        {"m1983", 965483},
        {"m1984", 647988},
        {"m1985", 819054},
        {"m1986", 442306},
        {"m1987", 802410},
        {"m1988", 171932},
        {"m1989", 763134},
        {"m1990", 40405},
        {"m1991", 774753},
        {"m1992", 501385},
        {"m1993", 597939},
        {"m1994", 625588},
        {"m1995", 572337},
        {"m1996", 854271},
        {"m1997", 203133},
        {"m1998", 899461},
        {"m1999", 204132},
        {"m2000", 278735},
    };

    //  加密后数据
    struct encidata edata[DATASIZE];

    //  加密数据字典  字符串为键，指针为值
    // dictionary *edata_dic = dictionary_new(10);

    //
    char *recvd_data;   //服务器回送的字符串
    unsigned long rel;  //存放询问结果

    //mpz_t 初始化
    mpz_init(pk_n);
    mpz_init(pk_g);
    mpz_init(sk_lambda);
    mpz_init(sk_mu);
    mpz_init(encipher_msg);
    mpz_init(rel_mpz);

    //
    key_generate(pk_n, pk_g, sk_lambda, sk_mu);
    printf("key generate\n");



    edata_init(edata, DATASIZE);
    // rd2ed(rdata, edata, DATASIZE, pk_n, pk_g);

    // for(int i=0; i<DATASIZE; i++){
    //     dictionary_set(edata_dic, edata[i].name, &edata[i]);
    // }

    // struct encidata *p = dictionary_get(edata_dic, "m3", NULL);
    // msg1 = decipher(p->encinumber, pk_n, sk_lambda, sk_mu);
    // printf("2:%ld\n", msg1);


    

    MYSQL *pConn = mysql_init(0);
    if(!mysql_real_connect(pConn, "175.24.183.10", "root", "Zs@123nihao", "encipher_data", 0, 0, 0))  //连接数据库，连接失败放回负值
    {
        printf("无法连接数据库: %s\n", mysql_error(pConn));
        exit(-1);
    }
    printf("连接数据库成功\n");

    // char sendbuf[BUFFER_SIZE];
    // char recvbuf[BUFFER_SIZE];
    // char *send_data;
    
    /*————————————传送公钥————————————*/
    // int msg1_size = mpz_sizeinbase(pk_n, 16);
    // int msg2_size = mpz_sizeinbase(pk_g, 16);
    // char msg1[msg1_size+1], msg2[msg2_size+1];
    // mpz_get_str(msg1, 16, pk_n); 
    // mpz_get_str(msg2, 16, pk_g); 
    
    // send_data = encode_msg( 0, msg1, msg2);
    // secure_send(sock_cli, send_data);  //传输公钥
    // free(send_data);                   //传输完毕后，释放send_data内存空间
    // secure_recv(sock_cli, &recvd_data);             //接收服务器返回消息
    // printf("%s\n",recvd_data+1);
    struct timeval tpstart,tpend;
    float timeuse;
    /*————————————传送数据————————————*/
    mpz_t temp;
    mpz_init(temp);

    gettimeofday(&tpstart,NULL);
    for(int i=0; i<100; i++){
        encipher(temp, pk_n, pk_g, rdata[i].number);
        int msg3_size = mpz_sizeinbase(temp, 16);
        char msg3[msg3_size+1];
        memset(msg3, 0, sizeof(msg3));
        mpz_get_str(msg3, 16, temp);
        char sql[4096];
        // printf("%ld\n",strlen(msg3));
        // printf("%s\n", msg3);
        snprintf(sql, sizeof(sql),"insert into data1(name, number) values('%s', '%s')", rdata[i].name, msg3);
        if(mysql_query(pConn,sql))      //执行指令,执行失败放回正值 注意单引号
            {   printf("%d\n", i);
                printf("插入失败,%s", mysql_error(pConn));
                exit(-1);
            }
        printf("%d\n", i);
    }    
    printf("Encrypted message sent\n");

    gettimeofday(&tpend,NULL);
    timeuse=1000000*(tpend.tv_sec-tpstart.tv_sec)+tpend.tv_usec-tpstart.tv_usec;
    timeuse/=1000;
    printf("Used Time:%f\n",timeuse);
   
    mysql_close(pConn);

    edata_clear(edata, DATASIZE);

    /*————————————clear mpz————————————*/
    mpz_clear(pk_n);
    mpz_clear(pk_g);
    mpz_clear(sk_lambda);
    mpz_clear(sk_mu);
    mpz_clear(encipher_msg);
    mpz_clear(rel_mpz);

    return 0;
}


void get_nbits_randprime(mpz_t randprime, int n){
    unsigned long seed;
    gmp_randstate_t state;
    mpz_t max, min, tmpmax;
    mpz_init(max);
    mpz_init(min);
    mpz_init(tmpmax);

    mpz_ui_pow_ui(max, 2, n);
    mpz_sub_ui(max, max, 1);
    mpz_ui_pow_ui(min, 2, n-1);
    mpz_sub(tmpmax, max, min);

    gmp_randinit_default(state);
    time(&seed);
    gmp_randseed_ui (state,seed);

    do{
        mpz_urandomm(randprime, state, tmpmax);
        mpz_add(randprime, randprime, min);
        mpz_nextprime(randprime, randprime);
    }while(mpz_cmp(randprime, max) >= 0);
    
    mpz_clear(max);
    mpz_clear(min);
    mpz_clear(tmpmax);
    gmp_randclear(state);
    return;
}
void get_randr(mpz_t r, mpz_t n){
    unsigned long seed;
    gmp_randstate_t state;
    mpz_t gcd_rn;

    mpz_init(gcd_rn);
    gmp_randinit_default(state);
    time(&seed);
    gmp_randseed_ui (state,seed);

    while(1){
        mpz_urandomm(r, state, n);
        mpz_gcd(gcd_rn,r,n);
        if(mpz_cmp_ui(gcd_rn, 1) == 0)
            break;
    }

    mpz_clear(gcd_rn);
    gmp_randclear(state);
    return;
}
void key_generate(mpz_t pk_n, mpz_t pk_g, mpz_t sk_lambda, mpz_t sk_mu){
    mpz_t p, q, gcd_nlmd;
    mpz_init(gcd_nlmd);
    mpz_init(p);
    mpz_init(q);

    // get pk_n,sk_lambda and gcd(pk_n,sk_lambda)==1
    while(1){
        get_nbits_randprime(p, KEYSIZE/2);
        get_nbits_randprime(q, KEYSIZE/2);

        while(mpz_cmp(p,q) == 0){
            get_nbits_randprime(q, KEYSIZE/2);
        }
        // gmp_printf("p: %Zd\n", p);
        // gmp_printf("q: %Zd\n", q);
        mpz_mul(pk_n, p, q);  
        mpz_sub_ui(p, p, 1);    // p=p-1
        mpz_sub_ui(q, q, 1);    // q=q-1
        mpz_mul(sk_lambda, p, q);
        mpz_gcd(gcd_nlmd, pk_n, sk_lambda);
        if(mpz_cmp_ui(gcd_nlmd, 1) == 0){
            break;
        } 
    }

    //get pk_g,sk_mu
    mpz_add_ui(pk_g, pk_n, 1);
    mpz_invert(sk_mu, sk_lambda, pk_n);

    mpz_clear(gcd_nlmd);
    mpz_clear(p);
    mpz_clear(q);
    return;
}

void encipher(mpz_t encipher_msg, mpz_t n, mpz_t g, unsigned long m){
    mpz_t r;        //随机数 r
    mpz_t gpowm;
    mpz_t rpown;
    mpz_t npow2;
    mpz_t temp;
    
    //mpz_t init
    mpz_init(r);
    mpz_init(gpowm);
    mpz_init(rpown);
    mpz_init(npow2);
    mpz_init(temp);

    //加密数据
    get_randr(r,n);                 //获取随机数 r 
    mpz_pow_ui(npow2, n, 2);        //npow2 = n^2
    mpz_powm_ui(gpowm, g, m, npow2);//gpown = g^m mod n^2
    mpz_powm(rpown, r, n, npow2);   //rpown = r^n mod n^2
    mpz_mul(temp, gpowm, rpown);    
    mpz_mod(encipher_msg, temp, npow2);//get encipher_msg

    //mpz_t clear
    mpz_clear(r);
    mpz_clear(gpowm);
    mpz_clear(rpown);
    mpz_clear(npow2);
    mpz_clear(temp);

    return;
}

unsigned long    decipher( mpz_t encipher_msg, mpz_t n ,mpz_t lambda, mpz_t mu){
    unsigned long decipher_msg;     //解密后数据
    mpz_t temp;
    mpz_t npow2;

    mpz_init(temp);
    mpz_init(npow2);

    mpz_pow_ui(npow2, n, 2);
    mpz_powm(temp, encipher_msg, lambda, npow2);
    mpz_sub_ui(temp, temp, 1);
    mpz_fdiv_q(temp, temp, n);
    mpz_mul(temp, temp, mu);
    mpz_mod(temp, temp, n);

    decipher_msg = mpz_get_ui(temp);

    mpz_clear(temp);
    mpz_clear(npow2);

    return decipher_msg;
}

char* encode_msg(int type, char* msg1, char* msg2){ //函数使用结束后需要free
    int header_size ;
    int msg1_size = strlen(msg1);
    int msg2_size = strlen(msg2);
    char header[10];
    header_size = snprintf(header, sizeof(header), "%1d%04d%04d", type, msg1_size, msg2_size);
    char *encode_msg = (char*)malloc((header_size+msg1_size+msg2_size+1)*sizeof(char));
    strcpy(encode_msg, header);
    strcat(encode_msg, msg1);
    strcat(encode_msg, msg2);
    return encode_msg;
}



void edata_init(struct encidata* edata, int size){ //程序最后需clear mpz_t
    /*初始化 size个结构体edate
      name 初始化为空串
      maz_t 初始化
    */
    int i;
    struct encidata *p = edata;
    
    for(i = 0; i<size; i++){
        memset((p+i)->name, 0, sizeof((p+i)->name));
        mpz_init((p+i)->encinumber);
    }
}
void edata_clear(struct encidata* edata, int size){ //程序最后需clear mpz_t
    /*clear size个结构体edate
      name 初始化为空串
      maz_t clear
    */
    int i;
    struct encidata *p = edata;

    for(i = 0; i<size; i++){
        memset((p+i)->name, 0, sizeof((p+i)->name));
        mpz_clear((p+i)->encinumber);
    }
}

void rd2ed(struct rawdata *rdata, struct encidata *edata, int size, mpz_t pk_n, mpz_t pk_g){ // 将rowdata中数据加密为encidata
    int i;

    for(i=0; i<size; i++)
    {
        strcpy((edata+i)->name, (rdata+i)->name);
        encipher((edata+i)->encinumber, pk_n, pk_g, (rdata+i)->number);
    }

}

void secure_recv(int sock_cli, char **precvd_msg){

    char recv_buffer[BUFFER_SIZE];
    char data_buffer[2048];
    memset(recv_buffer,0,sizeof(recv_buffer));
    memset(data_buffer,0,sizeof(data_buffer));
    int len = 0, point = 0;
    while(1){
        len = recv(sock_cli, recv_buffer, sizeof(recv_buffer), 0);
        if( len == 0)
        {
            break;
        }

        strncpy(data_buffer+point, recv_buffer, len);
        point += len;
        memset(recv_buffer,0,sizeof(recv_buffer));

        while(1)
        {
            if(strlen(data_buffer) < HEADER_SIZE)
            {
                break;
            }

            char header[HEADER_SIZE+1];
            int type_size = 1, size1;
            char s_t[TYPE_LEN+1], s_size1[MSG1BYTES_LEN+1];
            memset(header, 0, sizeof(header));
            memset(s_t, 0, sizeof(s_t));
            memset(s_size1, 0, sizeof(s_size1));

            strncpy(header, data_buffer, HEADER_SIZE);
            strncpy(s_t, header, TYPE_LEN);
            strncpy(s_size1, header+TYPE_LEN,MSG1BYTES_LEN);;
            size1 = atoi(s_size1); 

            if(strlen(data_buffer) < HEADER_SIZE + size1)
            {
                break;
            }


            if(strcmp(s_t, "0") == 0)  //服务器回送的一般消息
            {
                char *dmsg = (char*)calloc(size1+1, sizeof(char));
                
                strncpy(dmsg, data_buffer+HEADER_SIZE,size1);
                *precvd_msg = dmsg;
                // printf("type:%s\n",s_t);
                if(strncmp(dmsg, "0", 1) != 0)
                {
                    printf("server recieve wrong\n");
                }
                
                memset(data_buffer,0,sizeof(data_buffer));
            }
            if(strcmp(s_t, "1") == 0)
            {
                char *dmsg = (char*)calloc(size1+1, sizeof(char));
                strncpy(dmsg, data_buffer+HEADER_SIZE,size1);
                *precvd_msg = dmsg;
                // printf("type:%s\n",s_t);
                // printf("%s\n",dmsg1);
                memset(data_buffer,0,sizeof(data_buffer));
            }
        }

        if(strlen(data_buffer) == 0)
        {
            break;
        }
    }
}

void secure_send(int fd, char* send_data){  // 避免数据过长，而数据发送不完整，保证数据能完整传送完
    int len = 0;
    while(len<strlen(send_data)){
        len += send(fd, send_data, 1024, 0);
    }    
}

void my_fgets(char *str, int size){
    fgets(str, size, stdin);
    char *find = strchr(str, '\n');
    if(find){
        *find = '\0';
    }
}
int bits_10baseofnumber(int n){
    int cnt = 0;
    while(n)
    {
        n /= 10;
        cnt++;
    }
    return cnt;
}