## 代码流程框图

![](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20220329204636723.png)

- 1. 客户端通过**数据产生控制模块**，控制随机数的产生或停止。其中，1：产生数据 ,0：停止产生数据 ,-1：退出程序。

  2. **数据产生模块**产生的数据实时存储至**FIFO**中；并且以**ONETIMESIZE**个数据为一帧。

  3. 信号量sem_send的初始值为0，当数据每满一帧，sem_send值加1。

  4. 信号量sem_consumer的初始值为1，信号量sem_producer的初始值为0。

  5. 当sem_send和sem_consumer值均大于0时，sem_send和sem_consumer值均减1；将一帧数据存入**共享内存**，并将sem_producer值加1。

  6. 信号量的semC_encidata初始值为1，信号量semP_encidata的初始值为0。

  7. 当sem_producer和semC_encidata值均大于0时，sem_producer和semC_encidata值均减1；**加密模块**对一帧数据进行加密，并将semP_encidata值加1。

  8. 信号量的semC_cache初始值为1，信号量semP_cache的初始值为0。

  9. 当semP_encidata和semC_cache值均大于0时，semP_encidata和semC_cache值均减1；**加密数据缓存**对一帧加密数据进行缓存，并将semP_cache值加1。

  10. 当semP_cache值大于0时，semP_cache值减1；**加密数据上传**将一帧加密数据上传至**数据库**，并将semC_cache值加1。

      

+ 1. **加密模块**将产生的密钥共享给**客户端请求模块**。
  2. **客户端请求模块**向**服务器响应模块**发起请求。
  3. **服务器响应模块**根据客户端请求，从数据库获取加密数据，并对加密数据执行同态运算，最后将密文结果返回给**客户端请求模块**。
  4. **客户端请求模块**使用私钥解密密文结果，获得明文结果。